window.SP=function(){function e(){return r[c.env]}function n(n,o){return SP.Util.buildUrl(e()+i,{client_id:c.app_id,response_type:n,state:c.csrf,scope:o,redirect_uri:c.redirect_uri})}var o,t,r={prod:"//www.spreaker.com",beta:"//www.spreaker-beta.com",dev:"//www.dev-spreaker.com"},i="/oauth2/authorize",c={};return{init:function(e){if(!e.app_id)throw new Error("The param 'app_id' is required.");e.env=e.env||"prod",e.csrf=""+Math.random(),c=e},connect:function(e){"function"==typeof e&&(e={callback:e}),o=e,o.popup_id=SP.Popup.open(n(e.type||"token",e.scope||"basic"),{width:600,height:400,closed:SP.connectCallback})},connectCallback:function(){if(o){var e=o.popup_id,n=o.callback;o=void 0;var r,i=SP.Popup.getWindow(e);if(r=i?SP.Util.parseUrlParams(i.location.hash||i.location.search):{state:c.csrf,error:"canceled",error_description:"The user closed the popup."},!r.state)throw new Error("Connect callback invoked, but 'state' is missing.");if(r.state!==c.csrf)throw new Error("Connect callback invoked, but 'state' doesn't match.");t=r.access_token||void 0,SP.Popup.close(e),n&&n(r)}},disconnect:function(){t=void 0}}}(),window.SP.Popup=function(){function e(e){try{return!e||e.closed!==!1}catch(n){return!0}}function n(e){t[e].timer&&(clearInterval(t[e].timer),t[e].timer=void 0)}function o(n){t[n].timer=setInterval(function(){e(t[n].win)&&SP.Popup.close(n)},100)}var t={},r=1;return{open:function(e,n){var i=n.width||600,c=n.height||400,a=window.screenX+(window.outerWidth-i)/2,s=window.screenY+(window.outerHeight-c)/2,u=window.open(e,n.name||"","left="+a+",top="+s+",height="+c+",width="+i+",toolbar=no,scrollbars=yes"),d=r++;return t[d]={win:u,options:n},o(d),d},close:function(o){if(t[o]){n(o),t[o].win&&!e(t[o].win)&&t[o].win.close();var r=t[o].options.closed;t[o]=void 0,r&&r()}},getWindow:function(e){return t[e]&&t[e].win}}}(),window.SP.Util=function(){return{buildUrl:function(e,n){for(var o in n)n.hasOwnProperty(o)&&void 0!==n[o]&&(e+=(-1===e.indexOf("?")?"?":"&")+o+"="+encodeURIComponent(n[o]));return e},parseUrlParams:function(e){if(!e)return{};for(var n=e.replace(/^(\?|#)/,"").split("&"),o={},t=0;t<n.length;t++){var r=n[t].substring(0,n[t].indexOf("=")),i=decodeURIComponent(n[t].substring(n[t].indexOf("=")+1)).replace(/\+/g," ");o[r]=i}return o}}}();